<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta name="svg.render.forceflash" content="true" />
  <script src="../src/svg.js" data-path="../src" data-debug="true"></script>
</head>
<body><h1 style="margin:2px">Welcome to the SVGViewer Demo!
         <span style="font-size: 10pt">
          <a href='http://code.google.com/p/sgweb'
           >SVG rendering for common web browsers using Flash.</a>
          [<a href='http://code.google.com/p/sgweb/source/browse/trunk/docs/FAQ.html'
           >FAQ</a>]
          [<a href='http://code.google.com/p/sgweb/source/browse/trunk/docs/UserManual.html'
           > Manual </a>]</span></h1>
    <label>Select SVG:
    </label>
    <select id="selectSVG" onClick="showSVG();" >
        <option value="scim-anim">scimitar-anim
        <option value="scim">scimitar
        <option value="tiger">tiger
        <option value="spcar">sporty car - nice
        <option value="techcar">techy car - nice
        <option value="cam">camera
        <option value="ford">ford
        <option value="pg13">ratedpg13 - be patient
        <option value="eggs">eggs
        <option value="grapes">grapes
        <option value="metal">metal
        <option value="pres">presentation
        <option value="ufo">ufo
        <option value="acar">antique car
        <option value="blocks_game">blocks game
        <option value="photos">photos
        <option value="webstats">web stats
        <option value="us">us states
        <option value="snakes">snakes
        <option value="steps">steps
        <option value="circles1">circles1
        <option value="gaussian 1">gaussian collage
        <option value="gaussian 2">gaussian simple
        <option value="image">image
        <option value="lingrad1">linear grad 1
        <option value="lingrad2">linear grad 2
        <option value="lingrad3">linear grad: userSpace
        <option value="linear grad %">linear grad: bounding
        <option value="mouseEvents">mouseEvents
        <option value="pencil">pencil
        <option value="preserve">preserveAspectRatio
        <option value="radial">radialGradient
        <option value="smile">smile
        <option value="paths8">paths-data-08-t
        <option value="paths9">paths-data-09-t
        <option value="maskpath">masking-path-04-b
        <option value="polygon">shapes-polygon-01-t
        <option value="polyline">shapes-polyline-01-t
        <option value="clippath">clip-path
        <option value="pattern1">pservers-grad-03-b.svg
        <option value="pattern1-anim">pservers-grad-03-b-anim.svg
        <option value="pattern2">pservers-grad-06-b.svg
        <option value="w3cgradient1">pservers-grad-07-b.svg
        <option value="w3cgradient2">pservers-grad-09-b.svg
        <option value="w3cgradient3">pservers-grad-10-b.svg
        <option value="animate1">animate-elem-02-t.svg
    </select>
    <p id='selectModeP'><span>Select Display Mode:</span>
    <select id="selectMode" onClick="setMode(this.selectedIndex);">
        <option value="image">image
        <option value="xml">xml
    </select>
    </p>
    <p><span>Select Renderer:</span>
    <select id="selectRenderer" onClick="changeRenderer(this.value);">
        <option value="flash">rendered by Flash
        <option value="native">browser native svg
    </select>
    </p>
    <p>
    <span>viewBox:</span>
    <input id='inputViewBox' type="text" value=""/>
    <input type="button" onClick="setViewBox();" value="set" style="margin-right:10px"/>
    <input type="button" onClick="modVB(function(vb) {vb[0]=parseFloat(vb[0])+25.0;});" value="<"/>
    <input type="button" onClick="modVB(function(vb) {vb[0]=parseFloat(vb[0])-25.0;});" value=">"/>
    <input type="button" onClick="modVB(function(vb) {vb[1]=parseFloat(vb[1])+25.0;});" value="^"/>
    <input type="button" onClick="modVB(function(vb) {vb[1]=parseFloat(vb[1])-25.0;});" value="V"/>
    <input type="button" onClick="modVB(function(vb) {vb[2]=parseFloat(vb[2])/1.1;vb[3]=parseFloat(vb[3])/1.1;});" value="+"/>
    <input type="button" onClick="modVB(function(vb) {vb[2]=parseFloat(vb[2])*1.1;vb[3]=parseFloat(vb[3])*1.1;});" value="-"/>
    </p>
    <p><div id='mySVGDiv' style='display:block;float:left;'><!--SVG will go here --></div></p>
    <pre id='myXMLp' width="100%" style='clear:left;'></pre>

    <script type='text/javascript'>
    var currentSVGIndex = -1;
    var currentSVGObject;
    var SVGFiles= [
                    { svgURL: "scimitar-anim.svg", width:466,height:265 },
                    { svgURL: "scimitar.svg", width:466,height:265 },
                    { svgURL: "tiger.svg", width:800,height:800 },
                    { svgURL: "car.svg", width:900,height:600 },
                    { svgURL: "gallardo.svg", viewBox:'0 0 3800 1800',width:1000,height:600 },
                    { svgURL: "AJ_Digital_Camera.svg", width:406,height:206 },
                    { svgURL: "compuserver_msn_Ford_Focus.svg", width:548,height:303 },
                    { svgURL: "juanmontoya_lingerie.svg", width:858,height:1074 },
                    { svgURL: "rg1024_eggs.svg", width:430,height:474 },
                    { svgURL: "rg1024_green_grapes.svg", width:558,height:781 },
                    { svgURL: "rg1024_metal_effect.svg", width:445,height:479 },
                    { svgURL: "rg1024_Presentation_with_girl.svg", width:305,height:398 },
                    { svgURL: "rg1024_Ufo_in_metalic_style.svg", width:729,height:379 },
                    { svgURL: "tommek_Car.svg", width:1052,height:744 },
                    { svgURL: "blocks_game.svg", width:345,height:407 },
                    { svgURL: "photos.svg", width:800,height:600 },
                    { svgURL: "displayWebStats.svg", width:800,height:600 },
                    { svgURL: "USStates.svg" },
                    { svgURL: "snake.svg" },
                    { svgURL: "Steps.svg" },
                    { svgURL: "circles1.svg" },
                    { svgURL: "gaussian1.svg" },
                    { svgURL: "gaussian2.svg" },
                    { svgURL: "image.svg" },
                    { svgURL: "lineargradient1.svg" },
                    { svgURL: "lineargradient2.svg" },
                    { svgURL: "lineargradient3.svg" },
                    { svgURL: "lineargradient4.svg" },
                    { svgURL: "mouseEvents.svg" },
                    { svgURL: "pencil.svg" },
                    { svgURL: "preserveAspectRatio.svg" },
                    { svgURL: "radialgradient1.svg" },
                    { svgURL: "smile.svg" },
                    { svgURL: "paths-data-08-t.svg" },
                    { svgURL: "paths-data-09-t.svg" },
                    { svgURL: "masking-path-04-b.svg" },
                    { svgURL: "shapes-polygon-01-t.svg" },
                    { svgURL: "shapes-polyline-01-t.svg" },
                    { svgURL: "clippath.svg" },
                    { svgURL: "pservers-grad-03-b.svg" },
                    { svgURL: "pservers-grad-03-b-anim.svg" },
                    { svgURL: "pservers-grad-06-b.svg" },
                    { svgURL: "pservers-grad-07-b.svg" },
                    { svgURL: "pservers-grad-09-b.svg" },
                    { svgURL: "pservers-grad-10-b.svg" },
                    { svgURL: "animate-elem-02-t.svg" }
                  ];
                  
    /* 
      Internet Explorer's list of standard XHR PROGIDS. 
    */
    var XHR_PROGIDS = [
      'MSXML2.XMLHTTP.6.0', 'MSXML2.XMLHTTP.3.0', 'MSXML2.XMLHTTP',
      'Microsoft.XMLHTTP'
    ];

    /*
      Standard way to grab XMLHttpRequest object.
    */
    function xhrObj() {
        if (typeof XMLHttpRequest != 'undefined') {
          return new XMLHttpRequest();
        } else if (ActiveXObject) {
          var xhr = null;
          var i; // save the good PROGID for quicker access next time
          for (i = 0; i < XHR_PROGIDS.length && !xhr; ++i) {
            try {
              xhr = new ActiveXObject(XHR_PROGIDS[i]);
            } catch(e) {}
          }

          if (!xhr) {
            throw 'XMLHttpRequest object not available on this platform.';
          }

          return xhr;
        }
    }
                  
    function setMode(mode) {
        if (mode == 0) {
            document.getElementById('mySVGDiv').style.display='';
            document.getElementById('myXMLp').style.display='none';
        }
        if (mode == 1) {
            if (document.getElementById('mySVGDiv').style.display != 'none') {
                fetchXML(SVGFiles[svgIndex].svgURL);
            }
        }
    }
    
    function fetchXML(url) {
      var req = xhrObj();
      
      url = 'svg-files/' + url;

      // bust the cache for IE since IE's XHR GET requests are wonky
      if (isIE) {
        url += (url.indexOf('?') == -1) ? '?' : '&';
        url += new Date().getTime();
      }

      req.onreadystatechange = function() {
        if (req.readyState == 4) {
          if (req.status == 200) { // done
            showXML(req.responseText);
          } else { // error
            alert('Unable to fetch SVG file at ' + url + ': ' 
                  + req.status + ': ' + req.statusText);
          }
        }
      };

      req.open('GET', url, true);
      req.send(null);
    }
    
    function showXML(newXMLString) {
        var newline=isIE ? '\r\n' : '\n';
        newXMLString = newXMLString.split(/\r\n/g).join(newline);
        newXMLString = newXMLString.split(/\n|\r/g).join(newline);
        var xmlText = document.createTextNode(newXMLString);
        var myP = document.getElementById('myXMLp');
        if (myP.childNodes[0]) {
            myP.removeChild(myP.childNodes[0]);
        }
        document.getElementById('myXMLp').appendChild(xmlText);
        document.getElementById('mySVGDiv').style.display='none';
        document.getElementById('myXMLp').style.display='';
    }
    
    function svgOnLoad(msg) {
        if (SVGFiles[currentSVGIndex].viewBox) {
            currentSVGObject.contentDocument.documentElement.setAttribute('viewBox', SVGFiles[currentSVGIndex].viewBox);
            document.getElementById('inputViewBox').value = SVGFiles[currentSVGIndex].viewBox;
        }
        else {
            window.modVB(function(vb){});
        }
    }

    function showSVG(force) {
        var svgIndex;
        if (window.location.search.indexOf('svgIndex') != -1) {
          svgIndex = window.location.search.match(/svgIndex=([0-9]+)/)[1];
        } else {
          svgIndex=document.getElementById('selectSVG').selectedIndex;
        }
        if (currentSVGIndex != svgIndex || force) {
            var newSVG = SVGFiles[svgIndex];
            console.log('creating object!');
            currentSVGObject = document.createElement('object', true);
            currentSVGObject.setAttribute('type', 'image/svg+xml');
            currentSVGObject.setAttribute('data', 'svg-files/' + newSVG.svgURL);
            if (newSVG.width != undefined) {
              currentSVGObject.setAttribute('width', newSVG.width);
            }
            if (newSVG.height != undefined) {
              currentSVGObject.setAttribute('height', newSVG.height);
            }
            currentSVGObject.addEventListener('load', function() {
              // save a reference to the SVG OBJECT after its been transformed
              currentSVGObject = this;
              svgOnLoad();
            }, false);
            
            var container = document.getElementById('mySVGDiv');
            container.innerHTML = '';
            currentSVGObject = svgweb.appendChild(currentSVGObject, container);

            currentSVGIndex = svgIndex;
            
            document.getElementById('myXMLp').style.display='none';
            document.getElementById('selectMode').selectedIndex=0;
            document.getElementById('selectSVG').blur();
        }
    }

    function changeRenderer(newRenderer) {
      if (newRenderer != svgweb.getHandlerType()) {
        var url = window.location.toString();
        url = url.replace(/\?.*$/, '');
        url = '?svgIndex='+svgIndex;
        if (newRenderer == 'flash') {
          url += '&svg.render.forceflash=true';
        }
        
        window.location = url;
      }
    }

    function modVB(modfunc) {
        var width = currentSVGObject.getAttribute('width');
        var height = currentSVGObject.getAttribute('height');
        /*if (width.toString().indexOf('%') == -1) {
          width = Math.round(width);
        } else {
          if (window.getComputedStyle) { // W3C
            width = window.getComputedStyle(currentSVGObject, null).getPropertyValue('width');
            width = width.replace('px', '');
          } else { // IE
            width = currentSVGObject.offsetWidth;
          }
        } 
        if (height.toString().indexOf('%') == -1) {
          height = Math.round(height);
        } else {
          if (window.getComputedStyle) { // W3C
            height = window.getComputedStyle(currentSVGObject, null).getPropertyValue('height');
            height = height.replace('px', '');
          } else { // IE
            height = currentSVGObject.offsetHeight;
          }
        }*/

    }
    
    function setViewBox() {
        var viewBox = document.getElementById('inputViewBox').value;
        currentSVGObject.contentDocument.documentElement.setAttribute('viewBox', viewBox);
    }
    
    if (!document.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1')) {
        document.getElementById('selectRenderer').disabled='true';
    }
    
    svgweb.addOnLoad(function() {
      showSVG(true);
    });
    </script>
</body>
</html>
